<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="description" content="Portal redakcyjny magazynu „Zeszyty Komiksowe”">
        <title>Portal redakcyjny „Zeszytów Komiksowych”</title>
        <script src="Main.js"></script>
        <link rel=stylesheet href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel=stylesheet href="https://red.zeszytykomiksowe.org/static/styles.css">
        <link rel=icon href="https://red.zeszytykomiksowe.org/static/favicon.ico" sizes="16x16" type="image/vnd.microsoft.icon">
    </head>
    
    <body>
         <div id="elm-area"></div>
    </body>
    
    <script>
        var storedState = localStorage.getItem('ZKmodel');
        var startingState = storedState ? JSON.parse(storedState) : null;
        var elmApp = Elm.ZKMain.init({
          node: document.getElementById('elm-area'),
          flags: startingState
        });
        elmApp.ports.setStorage.subscribe(function(state) {
            localStorage.setItem('ZKmodel', JSON.stringify(state));
        });
        elmApp.ports.removeStorage.subscribe(function() {
            localStorage.removeItem('ZKmodel');
        });
        elmApp.ports.initiateFileUpload.subscribe(function(id) {

            var fileElem = document.getElementById(id);
            if(fileElem.files.length === 0){
                console.log('No file selected!');
                return;
            }

            var data = new FormData();
            data.append('SelectedFile', fileElem.files[0]);

            var request = new XMLHttpRequest();
            request.onreadystatechange = function(){
                if(request.readyState == 4) {
                    if(request.status === 200) { // success
                        console.log('It worked! ' + request.response);
                    } else {
                        console.log('Problem: ' + request.status);
                    }
                }
            };

            request.addEventListener('progress', function(e){
                console.log(Math.ceil(e.loaded/e.total) * 100 + '%');
            });

            request.addEventListener("error", function(e){
                console.log("An error occurred while transferring the file.");
                console.log(JSON.stringify(e));
            });

            request.addEventListener("abort", function(e){
                console.log("The transfer has been canceled by the user.");
                console.log(JSON.stringify(e));
            });

            request.open('POST', 'https://red.zeszytykomiksowe.org/banners/1/upload');
            request.send(data);
        });
    </script>
</html> 